{# ================= CONFIG ================= #}
{% set label = label if label is defined else "Benutzer" %}
{% set info_text = info_text if info_text is defined else "" %}
{% set field_id = field_id if field_id is defined else "assignee_id" %}
{% set field_name = field_name if field_name is defined else "assignee_name" %}
{% set initial_id = initial_id if initial_id is defined else "" %}
{% set initial_name = initial_name if initial_name is defined else "" %}

<div
  x-data="userDropdown({
    fieldId: '{{ field_id }}',
    fieldName: '{{ field_name }}',
    initialId: '{{ initial_id }}',
    initialName: '{{ initial_name }}'
  })"
  class="relative mt-4"
  @click.outside="close()"
>

  <!-- LABEL -->
  <label class="font-medium flex items-center gap-2">
    <span>{{ label }}</span>

    {% if info_text %}
    <span class="relative group cursor-help">
      <svg xmlns="http://www.w3.org/2000/svg"
           class="w-4 h-4 text-gray-400 hover:text-primary"
           fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M13 16h-1v-4h-1m1-4h.01M12 2a10 10 0 100 20 10 10 0 000-20z"/>
      </svg>

      <span
        class="absolute left-1/2 -translate-x-1/2 top-6
               whitespace-nowrap px-3 py-1.5 rounded
               bg-gray-900 text-white text-xs
               opacity-0 group-hover:opacity-100
               transition pointer-events-none z-50">
        {{ info_text }}
      </span>
    </span>
    {% endif %}
  </label>

  <!-- SEARCH INPUT -->
  <input
    type="text"
    x-model="search"
    @focus="open = true; filter()"
    @input="filter()"
    placeholder="Mitarbeiter:in auswÃ¤hlenâ€¦"
    class="input mt-1 cursor-pointer"
    autocomplete="off"
  >

  <!-- DROPDOWN -->
  <div
    x-show="open"
    x-transition
    @click.stop
    class="absolute z-30 w-full mt-1 max-h-56 overflow-auto
           bg-white dark:bg-gray-800 border rounded shadow text-sm"
  >
    <template x-for="u in filtered" :key="u.id">
      <div
        @click="select(u)"
        class="px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 cursor-pointer"
        x-text="u.display"
      ></div>
    </template>

    <div x-show="filtered.length === 0"
         class="px-3 py-2 text-gray-500">
      Keine Treffer
    </div>
  </div>

  <!-- ðŸ”‘ SINGLE SOURCE OF TRUTH -->
  <input type="hidden" :name="fieldId" :value="selectedId">
  <input type="hidden" :name="fieldName" :value="selectedName">
</div>
