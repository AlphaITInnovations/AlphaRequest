<div x-show="ticketType === 'EDV-Zugang sperren' && showTicketModal" x-cloak>
  <!-- Overlay -->
  <div class="fixed inset-0 bg-black/50 backdrop-blur-md z-40" @click="showTicketModal = false"></div>

  <!-- Modal -->
  <div class="fixed inset-0 z-50 overflow-y-auto" @keydown.escape.window="showTicketModal = false">
    <div class="min-h-screen flex items-center justify-center px-4 py-10">
      <div class="modal-panel w-full max-w-4xl p-6 relative"
           x-data="{
             sperren: {
               benutzer:'', grund:'',
               // ğŸ” Sperrmodus
               sperrmodus:'sofort', // 'sofort' | 'datum'
               sperrdatum:'',

               // ğŸ“§ Mail-Optionen
               mailsWeiterleiten:false, weiterleitenAn:'',
               postfachVollzugriff:false, vollzugriffFuer:'',
               abwesenheitAktiv:false, abwesenheitText:'Mitarbeiter ist nicht mehr im Haus',

               // ğŸ—ƒï¸ Daten
               datenAktion:'', datenBenutzer:'',

               // ğŸ’» Hardware (exklusiv)
               hardwareOption:'anIT', // 'anIT' | 'bleibt' | 'weitergabe'
               hardwareWeitergabeName:'',

               // BegrÃ¼ndung (falls nÃ¶tig)
               hardwareBegruendung:'',

               // ğŸ§¾ NEU: ELO-Sperre
               eloSperren:false,
               eloPosition:''
             },
             validate() {
               if (!this.sperren.benutzer.trim()) return { ok:false, msg:'Bitte Benutzername angeben.' };
               if (!this.sperren.grund.trim()) return { ok:false, msg:'Bitte Grund angeben.' };
               if (this.sperren.sperrmodus === 'datum' && !this.sperren.sperrdatum) {
                 return { ok:false, msg:'Bitte ein Sperrdatum wÃ¤hlen.' };
               }
               if (this.sperren.mailsWeiterleiten && !this.sperren.weiterleitenAn.trim()) {
                 return { ok:false, msg:'Bitte E-Mail fÃ¼r Weiterleitung angeben.' };
               }
               if (this.sperren.postfachVollzugriff && !this.sperren.vollzugriffFuer.trim()) {
                 return { ok:false, msg:'Bitte E-Mail fÃ¼r Vollzugriff angeben.' };
               }
               if (!this.sperren.datenAktion) {
                 return { ok:false, msg:'Bitte wÃ¤hlen, was mit den Daten passieren soll.' };
               }
               if (this.sperren.hardwareOption === 'weitergabe' && !this.sperren.hardwareWeitergabeName.trim()) {
                 return { ok:false, msg:'Bitte Namen des Mitarbeiters fÃ¼r die Hardware-Weitergabe angeben.' };
               }
               if (this.sperren.eloSperren && !this.sperren.eloPosition.trim()) {
                 return { ok:false, msg:'Bitte die Position fÃ¼r die ELO-Sperre angeben (z. B. Niederlassungsleiter).' };
               }
               return { ok:true };
             },
             submitSperrenForm() {
               const v = this.validate();
               if (!v.ok) { alert(v.msg); return; }
               const payload = { ticketType:'EDV-Zugang sperren', data:this.sperren };
               this.$refs.descField.value = JSON.stringify(payload);
               this.$refs.form.submit();
             }
           }"
      >

        <!-- Close -->
        <button @click="showTicketModal = false"
                class="absolute top-4 right-4 text-text hover:text-danger text-2xl focus-ring"
                aria-label="SchlieÃŸen">Ã—</button>

        <!-- Title -->
        <h3 class="text-2xl font-bold mb-6 text-text">ğŸ”’ EDV-Zugang sperren</h3>

        <!-- Form -->
        <form x-ref="form" method="post" action="/tickets" class="space-y-6" @submit.prevent="submitSperrenForm">
          <input type="hidden" name="title" value="EDV-Zugang sperren">
          <textarea x-ref="descField" name="description" class="hidden"></textarea>

          <!-- Benutzer -->
          <section class="card card--pad bg-card-bg border-border">
            <label class="text-text text-sm block mb-1">ğŸ‘¤ Benutzername</label>
            <input type="text" x-model="sperren.benutzer" class="field w-full" required>
          </section>

          <!-- Grund -->
          <section class="card card--pad bg-card-bg border-border">
            <label class="text-text text-sm block mb-1">ğŸ“ Grund</label>
            <textarea x-model="sperren.grund" rows="3" class="field w-full" placeholder="z. B. Austritt, Datenschutz" required></textarea>
          </section>

          <!-- Sperrmodus -->
          <section class="card card--pad bg-card-bg border-border">
            <p class="text-text text-sm font-medium mb-2">â±ï¸ Wann sperren?</p>
            <div class="flex flex-col sm:flex-row sm:items-center gap-3">
              <label class="inline-flex items-center gap-2">
                <input type="radio" class="field" name="sperrmodus" value="sofort" x-model="sperren.sperrmodus">
                <span>Sofort sperren</span>
              </label>
              <label class="inline-flex items-center gap-2">
                <input type="radio" class="field" name="sperrmodus" value="datum" x-model="sperren.sperrmodus">
                <span>Ab Datum sperren</span>
              </label>
              <input
                x-show="sperren.sperrmodus === 'datum'"
                type="date"
                class="field"
                x-model="sperren.sperrdatum"
              >
            </div>
          </section>

          <!-- NEU: ELO-Sperre -->
          <section class="card card--pad bg-card-bg border-border">
            <div class="flex items-center gap-2 mb-2">
              <input type="checkbox" x-model="sperren.eloSperren" id="eloSperren" class="field">
              <label for="eloSperren" class="text-text cursor-pointer">ELO-Benutzer ebenfalls sperren?</label>
            </div>
            <div x-show="sperren.eloSperren" class="mt-2">
              <label class="text-text text-sm block mb-1">Position des zu sperrenden Benutzers</label>
              <input type="text" class="field w-full"
                     placeholder="z. B. Niederlassungsleiter, Regionalleiter, ..."
                     x-model="sperren.eloPosition">
            </div>
          </section>

          <!-- Weiterleitung -->
          <section class="card card--pad bg-card-bg border-border">
            <div class="flex items-center gap-2 mb-2">
              <input type="checkbox" x-model="sperren.mailsWeiterleiten" id="mailForward" class="field">
              <label for="mailForward" class="text-text cursor-pointer">Mails weiterleiten?</label>
            </div>
            <input x-show="sperren.mailsWeiterleiten" type="email" x-model="sperren.weiterleitenAn"
                   placeholder="E-Mail-Adresse, an die weitergeleitet werden soll"
                   class="field w-full">
          </section>

          <!-- Postfach-Vollzugriff -->
          <section class="card card--pad bg-card-bg border-border">
            <div class="flex items-center gap-2 mb-2">
              <input type="checkbox" x-model="sperren.postfachVollzugriff" id="fullAccess" class="field">
              <label for="fullAccess" class="text-text cursor-pointer">Postfach-Vollzugriff?</label>
            </div>
            <input x-show="sperren.postfachVollzugriff" type="email" x-model="sperren.vollzugriffFuer"
                   placeholder="E-Mail-Adresse der Person mit Vollzugriff"
                   class="field w-full">
          </section>

          <!-- Abwesenheitsnotiz -->
          <section class="card card--pad bg-card-bg border-border">
            <div class="flex items-center gap-2 mb-2">
              <input type="checkbox" x-model="sperren.abwesenheitAktiv" id="ooo" class="field">
              <label for="ooo" class="text-text cursor-pointer">Abwesenheitsnotiz hinterlegen?</label>
            </div>
            <textarea x-show="sperren.abwesenheitAktiv" x-model="sperren.abwesenheitText" rows="2" class="field w-full"></textarea>
          </section>

          <!-- Hinweis -->
          <section class="card card--pad bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 text-yellow-800 dark:text-yellow-200">
            Weiterleitungen und Vollzugriffe bleiben nur 30 Tage aktiv. Danach erfolgt automatische Sicherung und LÃ¶schung.
          </section>

          <!-- Datenaktion -->
          <section class="card card--pad bg-card-bg border-border">
            <label class="text-text text-sm block">ğŸ—ƒï¸ Was soll mit den Daten passieren? (Home-Laufwerk, Desktop, etc.)</label>
            <select x-model="sperren.datenAktion" class="field w-full" required>
              <option value="">â€“ bitte wÃ¤hlen â€“</option>
              <option value="sichern">Sichern</option>
              <option value="lÃ¶schen">LÃ¶schen</option>
            </select>
          </section>

          <!-- Hardware -->
          <section class="card card--pad bg-card-bg border-border space-y-3">
            <label class="text-text text-sm block">ğŸ’» Was passiert mit der Hardware?</label>

            <div class="flex flex-col gap-2">
              <label class="inline-flex items-center gap-2">
                <input type="radio" class="field" name="hardwareOption" value="anIT" x-model="sperren.hardwareOption">
                <span>Wird an IT gesendet</span>
              </label>

              <label class="inline-flex items-center gap-2">
                <input type="radio" class="field" name="hardwareOption" value="bleibt" x-model="sperren.hardwareOption">
                <span>Bleibt in der Niederlassung</span>
              </label>

              <div>
                <label class="inline-flex items-center gap-2">
                  <input type="radio" class="field" name="hardwareOption" value="weitergabe" x-model="sperren.hardwareOption">
                  <span>Wird an einen Mitarbeiter weitergegeben</span>
                </label>
                <div class="mt-2" x-show="sperren.hardwareOption === 'weitergabe'">
                  <input type="text" class="field w-full" placeholder="Name des Mitarbeiters"
                         x-model="sperren.hardwareWeitergabeName">
                </div>
              </div>
            </div>

            <!-- Optionale BegrÃ¼ndung -->
            <div class="pt-2">
              <label class="text-text text-sm block mb-1">BegrÃ¼ndung (optional)</label>
              <textarea class="field w-full" rows="2" x-model="sperren.hardwareBegruendung"
                        placeholder="ZusÃ¤tzliche Hinweise/BegrÃ¼ndung..."></textarea>
            </div>
          </section>

          <!-- Footer -->
          <div class="pt-4 flex justify-end gap-3 border-t border-border mt-6">
            <button type="button" class="px-4 py-2 bg-card-bg text-text rounded-lg focus-ring" @click="showTicketModal = false">
              Abbrechen
            </button>
            <button type="submit" class="px-4 py-2 bg-primary hover:bg-primaryHover text-white rounded-lg focus-ring">
              Absenden
            </button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>
