<!-- modals/detail-zugang-sperren.html (DROP-IN REPLACEMENT) -->
<div x-cloak x-show="$store.modal.is('detail:zugang-sperren')" class="fixed inset-0 z-50">
  <!-- Overlay -->
  <div class="fixed inset-0 bg-black/40 backdrop-blur-sm z-40"
       @click="$store.modal.close()" aria-hidden="true"></div>

  <!-- Wrapper (fix wie Vorlage) -->
  <div class="fixed inset-0 z-50"
       x-trap="$store.modal.is('detail:zugang-sperren')"
       @keydown.escape.window="$store.modal.close()">
    <div class="min-h-screen flex items-center justify-center px-4 py-10">

      <!-- Panel -->
      <div
        class="modal-panel w-full max-w-5xl relative max-h-[85vh] h-auto flex flex-col"
        role="dialog"
        aria-modal="true"
        aria-labelledby="accBlockDetailTitle"
        x-data="{
          // --- Parse & Helpers ---
          parseDesc() {
            const o = $store.modal.data || {};
            const d = o.description;
            if (!d) return { ticketType: o.type || 'EDV-Zugang sperren', data: {} };
            try {
              if (typeof d === 'string') return JSON.parse(d);
              if (typeof d === 'object')  return d;
            } catch(_) {}
            return { ticketType: o.type || 'EDV-Zugang sperren', data: {} };
          },
          d(){ return $store.modal.data || {}; },
          payload(){ return this.parseDesc(); },
          z(){ return this.payload().data || {}; },

          fmt(v){ return (v===null||v===undefined||v==='') ? '‚Äì' : v; },
          chip(on){ return on
            ? 'inline-flex items-center gap-1 px-2 py-0.5 rounded bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200'
            : 'inline-flex items-center gap-1 px-2 py-0.5 rounded bg-gray-200 text-gray-700 dark:bg-gray-700/50 dark:text-gray-200';
          },
          statusLabel(s){ return ({approved:'Genehmigt', pending:'Ausstehend', rejected:'Abgelehnt'}[s]) || s; },
          statusClass(s){
            const base='inline-block px-2.5 py-0.5 text-xs font-semibold rounded-full align-middle';
            const m={approved:'bg-green-200/80 text-green-900 dark:bg-green-500/70 dark:text-black',
                     pending:'bg-yellow-200/80 text-yellow-900 dark:bg-yellow-500/70 dark:text-black',
                     rejected:'bg-red-200/80 text-red-900 dark:bg-red-600/70 dark:text-white'};
            return `${base} ${m[s] || 'bg-gray-200/80 text-gray-900 dark:bg-gray-600/70 dark:text-white'}`;
          },
          meta(){
            const o = this.d();
            return { id: o.id ?? '‚Äì', date: o.date ?? '‚Äì', creator: o.creator ?? null, status: o.status ?? 'pending' };
          },

          // --- Felder entsprechend neuem JSON ---
          benutzer(){ return this.z().benutzer; },
          grund(){ return this.z().grund; },

          // Sperrmodus: 'sofort' | 'datum' (+ sperrdatum)
          sperrmodus(){ return this.z().sperrmodus; },
          sperrdatum(){ return this.z().sperrdatum; },
          sperrmodusLabel(){
            return this.sperrmodus() === 'datum'
              ? `Ab ${this.fmt(this.sperrdatum())} sperren`
              : 'Sofort sperren';
          },

          // Mail/OOO/Postfach
          mailsWeiterleiten(){ return this.z().mailsWeiterleiten === true; },
          weiterleitenAn(){ return this.z().weiterleitenAn; },
          postfachVollzugriff(){ return this.z().postfachVollzugriff === true; },
          vollzugriffFuer(){ return this.z().vollzugriffFuer; },
          abwesenheitAktiv(){ return this.z().abwesenheitAktiv === true; },
          abwesenheitText(){ return this.z().abwesenheitText; },

          // Daten
          datenAktion(){ return this.z().datenAktion; },     // 'sichern' | 'l√∂schen'
          datenBenutzer(){ return this.z().datenBenutzer; },

          // üíª Hardware (neu: hardwareOption + optional Name)
          hardwareOption(){ return this.z().hardwareOption; }, // 'anIT' | 'bleibt' | 'weitergabe'
          hardwareWeitergabeName(){ return this.z().hardwareWeitergabeName; },
          hardwareBegruendung(){ return this.z().hardwareBegruendung; },

          // üßæ ELO (neu)
          eloSperren(){ return this.z().eloSperren === true; },
          eloPosition(){ return this.z().eloPosition; },

          // Helper f√ºr Anzeige
          hwBadgeText(){
            const opt = this.hardwareOption();
            if (opt === 'anIT') return 'Wird an IT gesendet';
            if (opt === 'bleibt') return 'Bleibt in der Niederlassung';
            if (opt === 'weitergabe') return 'Wird an Mitarbeiter weitergegeben';
            return '‚Äì keine Angaben ‚Äì';
          }
        }"
      >

        <!-- Header (fix) -->
        <div class="relative p-5 sm:p-6 border-b border-gray-200 dark:border-gray-700">
          <div class="absolute inset-0 bg-gradient-to-r from-primary/10 via-primary/5 to-transparent pointer-events-none"></div>
          <div class="relative flex items-start justify-between gap-4">
            <div>
              <h3 id="accBlockDetailTitle" class="text-2xl sm:text-3xl font-bold flex items-center gap-2">
                <span class="text-3xl">üîí</span>
                <span>EDV-Zugang sperren</span>
              </h3>
              <div class="mt-2 flex flex-wrap items-center gap-2 text-sm">
                <span :class="statusClass(meta().status)" x-text="statusLabel(meta().status)"></span>
                <span class="text-muted">‚Ä¢</span>
                <span class="text-muted">ID: <span class="font-medium text-text" x-text="meta().id"></span></span>
                <span class="text-muted">‚Ä¢</span>
                <span class="text-muted">Datum: <span class="font-medium text-text" x-text="meta().date"></span></span>
                <template x-if="meta().creator">
                  <span class="text-muted">‚Ä¢ Ersteller: <span class="font-medium text-text" x-text="meta().creator"></span></span>
                </template>
              </div>
            </div>
          </div>
        </div>

        <!-- BODY (scrollt) -->
        <div class="flex-1 overflow-auto p-5 sm:p-6 space-y-5">

          <!-- Benutzer & Grund -->
          <section class="card card--pad">
            <h4 class="font-semibold mb-3">üßæ Benutzer & Grund</h4>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
              <div>
                <div class="text-muted">Benutzer</div>
                <div class="font-medium break-words" x-text="fmt(benutzer())"></div>
              </div>
              <div>
                <div class="text-muted">Sperrmodus</div>
                <div class="font-medium break-words" x-text="sperrmodusLabel()"></div>
              </div>
              <div class="sm:col-span-2">
                <div class="text-muted">Grund</div>
                <div class="font-medium whitespace-pre-line" x-text="fmt(grund())"></div>
              </div>
            </div>
          </section>

          <!-- Mail & Postfach -->
          <section class="card card--pad">
            <h4 class="font-semibold mb-3">üì¨ Mail & Postfach</h4>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
              <div>
                <div class="text-muted">Mails weiterleiten</div>
                <div class="flex items-center gap-2">
                  <span :class="chip(mailsWeiterleiten())" x-text="mailsWeiterleiten() ? 'Ja' : 'Nein'"></span>
                  <template x-if="mailsWeiterleiten() && fmt(weiterleitenAn()) !== '‚Äì'">
                    <span class="text-muted">‚Ä¢ an <span class="font-medium" x-text="weiterleitenAn()"></span></span>
                  </template>
                </div>
              </div>
              <div>
                <div class="text-muted">Postfach-Vollzugriff</div>
                <div class="flex items-center gap-2">
                  <span :class="chip(postfachVollzugriff())" x-text="postfachVollzugriff() ? 'Ja' : 'Nein'"></span>
                  <template x-if="postfachVollzugriff() && fmt(vollzugriffFuer()) !== '‚Äì'">
                    <span class="text-muted">‚Ä¢ f√ºr <span class="font-medium" x-text="vollzugriffFuer()"></span></span>
                  </template>
                </div>
              </div>
              <div class="sm:col-span-2">
                <div class="text-muted">Abwesenheitsnotiz</div>
                <template x-if="abwesenheitAktiv()">
                  <div class="font-medium whitespace-pre-line" x-text="fmt(abwesenheitText())"></div>
                </template>
                <template x-if="!abwesenheitAktiv()">
                  <div class="font-medium">‚Äì nicht aktiv ‚Äì</div>
                </template>
              </div>
            </div>
            <p class="mt-3 text-xs text-yellow-800 dark:text-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 rounded-md px-3 py-2">
              Hinweis: Weiterleitungen und Vollzugriffe bleiben nur 30 Tage aktiv. Danach erfolgt automatische Sicherung und L√∂schung.
            </p>
          </section>

          <!-- üßæ ELO -->
          <section class="card card--pad">
            <h4 class="font-semibold mb-3">üìÅ ELO</h4>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
              <div>
                <div class="text-muted">ELO-Benutzer sperren</div>
                <div>
                  <span :class="chip(eloSperren())" x-text="eloSperren() ? 'Ja' : 'Nein'"></span>
                </div>
              </div>
              <template x-if="eloSperren() && fmt(eloPosition()) !== '‚Äì'">
                <div>
                  <div class="text-muted">Position</div>
                  <div class="font-medium break-words" x-text="eloPosition()"></div>
                </div>
              </template>
            </div>
          </section>

          <!-- Datenaktion -->
          <section class="card card--pad">
            <h4 class="font-semibold mb-3">üóÉÔ∏è Daten</h4>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
              <div>
                <div class="text-muted">Aktion</div>
                <div class="font-medium capitalize" x-text="fmt(datenAktion())"></div>
              </div>
              <template x-if="fmt(datenBenutzer()) !== '‚Äì'">
                <div>
                  <div class="text-muted">Ziel-Benutzer</div>
                  <div class="font-medium break-words" x-text="datenBenutzer()"></div>
                </div>
              </template>
            </div>
          </section>

          <!-- Hardware -->
          <section class="card card--pad">
            <h4 class="font-semibold mb-3">üíª Hardware</h4>
            <div class="flex flex-wrap items-center gap-2 text-sm">
              <div :class="chip(true)" x-text="hwBadgeText()"></div>
            </div>

            <!-- Weitergabe: Name anzeigen -->
            <template x-if="hardwareOption() === 'weitergabe' && fmt(hardwareWeitergabeName()) !== '‚Äì'">
              <div class="mt-3 text-sm">
                <div class="text-muted">Weitergabe an</div>
                <div class="font-medium" x-text="hardwareWeitergabeName()"></div>
              </div>
            </template>

            <!-- Begr√ºndung (optional) -->
            <template x-if="fmt(hardwareBegruendung()) !== '‚Äì'">
              <div class="mt-3">
                <div class="text-muted text-sm mb-1">Begr√ºndung</div>
                <p class="text-sm whitespace-pre-line" x-text="hardwareBegruendung()"></p>
              </div>
            </template>
          </section>

          <!-- Abschlusskommentar -->
          <section class="card card--pad">
            <h4 class="font-semibold mb-2">üí¨ Abschlusskommentar</h4>
            <p class="text-sm" x-text="d().comment || '‚Äì kein Kommentar ‚Äì'"></p>
          </section>

        </div>

        <!-- Footer (fix) -->
        <div class="px-5 sm:px-6 py-4 border-t dark:border-gray-700">
          <div class="flex justify-end">
            <button type="button"
                    class="px-5 py-2 bg-primary hover:bg-primaryHover text-white rounded-md"
                    @click="$store.modal.close()">
              Schlie√üen
            </button>
          </div>
        </div>

      </div><!-- /Panel -->
    </div>
  </div>
</div>
