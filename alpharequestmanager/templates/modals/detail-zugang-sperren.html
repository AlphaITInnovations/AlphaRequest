<!-- modals/detail-zugang-sperren.html -->
<div x-cloak x-show="$store.modal.is('detail:zugang-sperren')" class="fixed inset-0 z-50">
  <!-- Overlay -->
  <div class="fixed inset-0 bg-black/40 backdrop-blur-sm"
       @click="$store.modal.close()" aria-hidden="true"></div>

  <!-- Panel -->
  <div class="relative min-h-screen flex items-center justify-center px-4 py-10">
    <div
      class="modal-panel w-full max-w-5xl relative overflow-hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="accBlockDetailTitle"
      x-trap="$store.modal.is('detail:zugang-sperren')"
      @keydown.escape.window="$store.modal.close()"
      x-data="{
        // --- Parse & Helpers ---
        parseDesc() {
          const o = $store.modal.data || {};
          const d = o.description;
          if (!d) return { ticketType: o.type || 'EDV-Zugang sperren', data: {} };
          try { if (typeof d === 'string') return JSON.parse(d); if (typeof d === 'object') return d; } catch(_) {}
          return { ticketType: o.type || 'EDV-Zugang sperren', data: {} };
        },
        d(){ return $store.modal.data || {}; },
        payload(){ return this.parseDesc(); },
        z(){ return this.payload().data || {}; },

        fmt(v){ return (v===null||v===undefined||v==='') ? 'â€“' : v; },
        chip(on){ return on
          ? 'inline-flex items-center gap-1 px-2 py-0.5 rounded bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-200'
          : 'inline-flex items-center gap-1 px-2 py-0.5 rounded bg-gray-200 text-gray-700 dark:bg-gray-700/50 dark:text-gray-200';
        },
        statusLabel(s){ return ({approved:'Genehmigt', pending:'Ausstehend', rejected:'Abgelehnt'}[s]) || s; },
        statusClass(s){
          const base='inline-block px-2.5 py-0.5 text-xs font-semibold rounded-full align-middle';
          const m={approved:'bg-green-200/80 text-green-900 dark:bg-green-500/70 dark:text-black',
                   pending:'bg-yellow-200/80 text-yellow-900 dark:bg-yellow-500/70 dark:text-black',
                   rejected:'bg-red-200/80 text-red-900 dark:bg-red-600/70 dark:text-white'};
          return `${base} ${m[s] || 'bg-gray-200/80 text-gray-900 dark:bg-gray-600/70 dark:text-white'}`;
        },
        meta(){
          const o = this.d();
          return { id: o.id ?? 'â€“', date: o.date ?? 'â€“', creator: o.creator ?? null, status: o.status ?? 'pending' };
        },

        // --- Felder exakt nach deinem JSON ---
        benutzer(){ return this.z().benutzer; },
        grund(){ return this.z().grund; },
        sofort(){ return this.z().sofort === true; },

        mailsWeiterleiten(){ return this.z().mailsWeiterleiten === true; },
        weiterleitenAn(){ return this.z().weiterleitenAn; },

        postfachVollzugriff(){ return this.z().postfachVollzugriff === true; },
        vollzugriffFuer(){ return this.z().vollzugriffFuer; },

        abwesenheitAktiv(){ return this.z().abwesenheitAktiv === true; },
        abwesenheitText(){ return this.z().abwesenheitText; },

        datenAktion(){ return this.z().datenAktion; },        // 'sichern' | 'lÃ¶schen'
        datenBenutzer(){ return this.z().datenBenutzer; },

        hw(){ return this.z().hardware || {}; },               // { anIT, bleibt }
        hwAnIT(){ return !!this.hw().anIT; },
        hwBleibt(){ return !!this.hw().bleibt; },
        hardwareBegruendung(){ return this.z().hardwareBegruendung; }
      }"
    >

      <!-- Header -->
      <div class="relative p-5 sm:p-6 border-b border-gray-200 dark:border-gray-700">
        <div class="absolute inset-0 bg-gradient-to-r from-primary/10 via-primary/5 to-transparent pointer-events-none"></div>
        <div class="relative flex items-start justify-between gap-4">
          <div>
            <h3 id="accBlockDetailTitle" class="text-2xl sm:text-3xl font-bold flex items-center gap-2">
              <span class="text-3xl">ğŸ”’</span>
              <span>EDV-Zugang sperren</span>
            </h3>
            <div class="mt-2 flex flex-wrap items-center gap-2 text-sm">
              <span :class="statusClass(meta().status)" x-text="statusLabel(meta().status)"></span>
              <span class="text-muted">â€¢</span>
              <span class="text-muted">ID: <span class="font-medium text-text" x-text="meta().id"></span></span>
              <span class="text-muted">â€¢</span>
              <span class="text-muted">Datum: <span class="font-medium text-text" x-text="meta().date"></span></span>
              <template x-if="meta().creator">
                <span class="text-muted">â€¢ Ersteller: <span class="font-medium text-text" x-text="meta().creator"></span></span>
              </template>
            </div>
          </div>
        </div>
      </div>

      <!-- CONTENT -->
      <div class="p-5 sm:p-6 space-y-5">

        <!-- Benutzer & Grund -->
        <section class="card card--pad">
          <h4 class="font-semibold mb-3">ğŸ§¾ Benutzer & Grund</h4>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
            <div>
              <div class="text-muted">Benutzer</div>
              <div class="font-medium break-words" x-text="fmt(benutzer())"></div>
            </div>
            <div>
              <div class="text-muted">Sofort sperren</div>
              <div :class="chip(sofort())"><span x-text="sofort() ? 'Ja' : 'Nein'"></span></div>
            </div>
            <div class="sm:col-span-2">
              <div class="text-muted">Grund</div>
              <div class="font-medium whitespace-pre-line" x-text="fmt(grund())"></div>
            </div>
          </div>
        </section>

        <!-- Mail & Postfach -->
        <section class="card card--pad">
          <h4 class="font-semibold mb-3">ğŸ“¬ Mail & Postfach</h4>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
            <div>
              <div class="text-muted">Mails weiterleiten</div>
              <div class="flex items-center gap-2">
                <span :class="chip(mailsWeiterleiten())" x-text="mailsWeiterleiten() ? 'Ja' : 'Nein'"></span>
                <template x-if="mailsWeiterleiten() && fmt(weiterleitenAn()) !== 'â€“'">
                  <span class="text-muted">â€¢ an <span class="font-medium" x-text="weiterleitenAn()"></span></span>
                </template>
              </div>
            </div>
            <div>
              <div class="text-muted">Postfach-Vollzugriff</div>
              <div class="flex items-center gap-2">
                <span :class="chip(postfachVollzugriff())" x-text="postfachVollzugriff() ? 'Ja' : 'Nein'"></span>
                <template x-if="postfachVollzugriff() && fmt(vollzugriffFuer()) !== 'â€“'">
                  <span class="text-muted">â€¢ fÃ¼r <span class="font-medium" x-text="vollzugriffFuer()"></span></span>
                </template>
              </div>
            </div>
            <div class="sm:col-span-2">
              <div class="text-muted">Abwesenheitsnotiz</div>
              <template x-if="abwesenheitAktiv()">
                <div class="font-medium whitespace-pre-line" x-text="fmt(abwesenheitText())"></div>
              </template>
              <template x-if="!abwesenheitAktiv()">
                <div class="font-medium">â€“ nicht aktiv â€“</div>
              </template>
            </div>
          </div>
          <p class="mt-3 text-xs text-yellow-800 dark:text-yellow-200 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 rounded-md px-3 py-2">
            Hinweis: Weiterleitungen und Vollzugriffe bleiben nur 30 Tage aktiv. Danach erfolgt automatische Sicherung und LÃ¶schung.
          </p>
        </section>

        <!-- Datenaktion -->
        <section class="card card--pad">
          <h4 class="font-semibold mb-3">ğŸ—ƒï¸ Daten</h4>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
            <div>
              <div class="text-muted">Aktion</div>
              <div class="font-medium capitalize" x-text="fmt(datenAktion())"></div>
            </div>
            <template x-if="fmt(datenBenutzer()) !== 'â€“'">
              <div>
                <div class="text-muted">Ziel-Benutzer</div>
                <div class="font-medium break-words" x-text="datenBenutzer()"></div>
              </div>
            </template>
          </div>
        </section>

        <!-- Hardware -->
        <section class="card card--pad">
          <h4 class="font-semibold mb-3">ğŸ’» Hardware</h4>
          <div class="flex flex-wrap items-center gap-2 text-sm">
            <template x-if="hwAnIT()"><div :class="chip(true)">Wird an IT gesendet âœ“</div></template>
            <template x-if="hwBleibt()"><div :class="chip(true)">Bleibt in der Niederlassung âœ“</div></template>
            <template x-if="!hwAnIT() && !hwBleibt()">
              <span class="text-muted">â€“ keine Angaben â€“</span>
            </template>
          </div>

          <template x-if="fmt(hardwareBegruendung()) !== 'â€“'">
            <div class="mt-3">
              <div class="text-muted text-sm mb-1">BegrÃ¼ndung</div>
              <p class="text-sm whitespace-pre-line" x-text="hardwareBegruendung()"></p>
            </div>
          </template>
        </section>

        <!-- Abschlusskommentar -->
        <section class="card card--pad">
          <h4 class="font-semibold mb-2">ğŸ’¬ Abschlusskommentar</h4>
          <p class="text-sm" x-text="d().comment || 'â€“ kein Kommentar â€“'"></p>
        </section>

        <!-- Footer -->
        <div class="pt-4 flex justify-end border-t border-border mt-6">
          <button type="button"
                  class="px-5 py-2 bg-primary hover:bg-primaryHover text-white rounded-md"
                  @click="$store.modal.close()">
            SchlieÃŸen
          </button>
        </div>

      </div>
    </div>
  </div>
</div>
