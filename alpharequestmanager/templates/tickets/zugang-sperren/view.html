{% extends "base.html" %}
{% block title %}Auftrag â€“ Zugang sperren{% endblock %}

{% set phase = "view" %}

{% block content %}
<div class="max-w-6xl mx-auto p-8 space-y-8">

  {% set p = description.personal if description and description.personal is defined else {} %}
  {% set it = description.it if description and description.it is defined else {} %}
  {% set f = description.fuhrpark if description and description.fuhrpark is defined else {} %}

  <style>
    .ro-label {
      display: block;
      font-size: .75rem;
      line-height: 1rem;
      color: rgb(107 114 128); /* gray-500 */
      font-weight: 600;
      margin-bottom: .125rem;
    }
    .ro-value {
      font-size: .875rem;
      line-height: 1.25rem;
      white-space: normal;
      word-break: break-word;
      color: inherit;
    }
    .ro-pre {
      white-space: pre-wrap;
      word-break: break-word;
      font-size: .875rem;
      line-height: 1.25rem;
      color: inherit;
    }
    .hint-box {
      border: 1px solid rgb(253 230 138); /* amber-200 */
      background: rgb(255 251 235); /* amber-50 */
    }
    .dark .hint-box {
      border-color: rgb(217 119 6); /* amber-600 */
      background: rgba(120,53,15,.2);
    }
  </style>

  <!-- ================================================= -->
  <!-- HEADER -->
  <!-- ================================================= -->
  <div class="bg-white dark:bg-gray-800 border rounded-xl shadow p-6">
    <h1 class="text-xl font-semibold">{{ ticket.title }}</h1>
    <p class="text-sm text-gray-500 mt-1">
      Erstellt am {{ ticket.created_at.strftime("%d.%m.%Y %H:%M") }}
    </p>
  </div>

  <!-- ================================================= -->
  <!-- LAYOUT -->
  <!-- ================================================= -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

    <!-- ================================================= -->
    <!-- META -->
    <!-- ================================================= -->
    <aside class="bg-white dark:bg-gray-800 border rounded-xl shadow p-6">
      <div class="space-y-4 text-sm">

        <div>
          <div class="font-medium text-gray-500">Ticketstatus</div>
          <div>{{ ticket.status.value }}</div>
        </div>

        <div>
          <div class="font-medium text-gray-500">PrioritÃ¤t</div>
          <div>{{ ticket.priority.value|capitalize }}</div>
        </div>

        <div>
          <div class="font-medium text-gray-500">Antragsteller</div>
          <div>{{ ticket.owner_name }}</div>
        </div>

        <div class="pt-4 border-t space-y-2">
          <div class="font-medium text-gray-500">Details</div>

          <div>
            <span class="ro-label">Verantwortlicher</span>
            <div class="ro-value">{{ ticket.accountable_name or "â€”" }}</div>
          </div>

          <div>
            <span class="ro-label">Vorgesetzter</span>
            <div class="ro-value">{{ ticket.supervisor_name or "â€”" }}</div>
          </div>

          {% if ticket.comment %}
          <div>
            <span class="ro-label">Kommentar</span>
            <pre class="ro-pre">{{ ticket.comment }}</pre>
          </div>
          {% endif %}
        </div>

      </div>
    </aside>

    <!-- ================================================= -->
    <!-- CONTENT -->
    <!-- ================================================= -->
    <section class="lg:col-span-2 space-y-10">

      <!-- ================================================= -->
      <!-- PERSONAL -->
      <!-- ================================================= -->
      <div class="bg-white dark:bg-gray-800 border rounded-xl shadow p-6">
        <h2 class="font-semibold text-lg mb-4">Personalabteilung</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <span class="ro-label">Vorname</span>
            <div class="ro-value">{{ p.first_name|default("â€”") }}</div>
          </div>

          <div>
            <span class="ro-label">Nachname</span>
            <div class="ro-value">{{ p.last_name|default("â€”") }}</div>
          </div>

          <div>
            <span class="ro-label">Kostenstelle</span>
            <div class="ro-value">{{ p.cost_center|default("â€”") }}</div>
          </div>

          <div>
            <span class="ro-label">Firma lt. Arbeitsvertrag</span>
            <div class="ro-value">{{ p.contract_company|default("â€”") }}</div>
          </div>

          <div>
            <span class="ro-label">Austrittsdatum</span>
            <div class="ro-value">{{ p.exit_date|default("â€”") }}</div>
          </div>
        </div>
      </div>

      <!-- ================================================= -->
      <!-- IT -->
      <!-- ================================================= -->
      <div class="bg-white dark:bg-gray-800 border rounded-xl shadow p-6 space-y-6">
        <h2 class="font-semibold text-lg">IT</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

          <!-- Mailweiterleitung -->
          <div>
            <span class="ro-label">Mailweiterleitung?</span>
            <div class="ro-value">{{ it.mail_forwarding|default("â€”") }}</div>
          </div>

          {% if it.mail_forwarding == "Ja" %}
          <div>
            <span class="ro-label">Weiterleiten an (eine Person)</span>
            <div class="ro-value">{{ it.mail_forward_to|default("â€”") }}</div>
          </div>
          {% else %}
          <div>
            <span class="ro-label">Weiterleiten an (eine Person)</span>
            <div class="ro-value">â€”</div>
          </div>
          {% endif %}

          <!-- Postfachzugriff -->
          <div>
            <span class="ro-label">Postfachzugriff gewÃ¤hren?</span>
            <div class="ro-value">{{ it.mailbox_access|default("â€”") }}</div>
          </div>

          {% if it.mailbox_access == "Ja" %}
          <div class="md:col-span-2">
            <span class="ro-label">Zugriff fÃ¼r (mehrere Personen mÃ¶glich)</span>
            {% if it.mailbox_access_for %}
              <pre class="ro-pre">{{ it.mailbox_access_for }}</pre>
            {% else %}
              <div class="ro-value">â€”</div>
            {% endif %}
          </div>
          {% else %}
          <div class="md:col-span-2">
            <span class="ro-label">Zugriff fÃ¼r (mehrere Personen mÃ¶glich)</span>
            <div class="ro-value">â€”</div>
          </div>
          {% endif %}

          <!-- Abwesenheitsnotiz -->
          <div>
            <span class="ro-label">Abwesenheitsnotiz aktivieren?</span>
            <div class="ro-value">{{ it.auto_reply|default("â€”") }}</div>
          </div>

          {% if it.auto_reply == "Ja" %}
          <div class="md:col-span-2">
            <span class="ro-label">Text der Abwesenheitsnotiz</span>
            {% if it.auto_reply_text %}
              <pre class="ro-pre">{{ it.auto_reply_text }}</pre>
            {% else %}
              <div class="ro-value">â€”</div>
            {% endif %}
          </div>
          {% else %}
          <div class="md:col-span-2">
            <span class="ro-label">Text der Abwesenheitsnotiz</span>
            <div class="ro-value">â€”</div>
          </div>
          {% endif %}

        </div>

        <!-- Hinweise -->
        <div class="hint-box rounded-lg p-4 text-sm">
          <div class="font-semibold mb-1">ðŸ“Œ Wichtige Hinweise</div>
          <ul class="list-disc pl-5 space-y-1">
            <li><strong>Mailweiterleitung</strong> und <strong>Postfachzugriff</strong> sind jeweils <strong>maximal 30 Tage</strong> mÃ¶glich.</li>
            <li>PostfÃ¤cher werden weiterhin gesichert, <strong>neue E-Mails werden jedoch nicht mehr zugestellt</strong>.</li>
            <li>Abwesenheitsnotiz enthÃ¤lt ggf. Platzhalter (<code>&lt;Name&gt;</code>, <code>&lt;Ersatzmailadresse&gt;</code>).</li>
          </ul>
        </div>
      </div>

      <!-- ================================================= -->
      <!-- FUHRPARK -->
      <!-- ================================================= -->
      <div class="bg-white dark:bg-gray-800 border rounded-xl shadow p-6">
        <h2 class="font-semibold text-lg mb-4">Fuhrpark</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <span class="ro-label">Dienstwagen vorhanden?</span>
            <div class="ro-value">{{ f.car|default("â€”") }}</div>
          </div>

          {% if f.car == "Ja" %}
          <div>
            <span class="ro-label">RÃ¼ckgabedatum</span>
            <div class="ro-value">{{ f.car_return_date|default("â€”") }}</div>
          </div>
          {% else %}
          <div>
            <span class="ro-label">RÃ¼ckgabedatum</span>
            <div class="ro-value">â€”</div>
          </div>
          {% endif %}
        </div>
      </div>

    </section>
  </div>

  <!-- ================================================= -->
  <!-- ACTIONS / DEPARTMENT STATUS -->
  <!-- ================================================= -->
  {% include "tickets/partials/_ticket_actions.html" %}

</div>
{% endblock %}
